# Variables environnement et configuration

Configurer votre environnement Linux pour l'IA

## Note importante

Les corrections des exercices pratiques de ce module sont disponibles dans le repository GitHub du cours mentionné dans le document d'introduction (0.1).

## Table des matières

1. [Variables d'environnement de base](#variables-base)
2. [Configuration PATH](#configuration-path)
3. [Variables spécifiques à l'IA](#variables-ia)
4. [Fichiers de configuration](#fichiers-config)

## Variables d'environnement de base

### Théorie : Rôle des variables d'environnement

Les variables d'environnement configurent le comportement des programmes. En IA, elles sont cruciales pour définir les chemins vers les bibliothèques, configurer les GPUs, et personnaliser les environnements de développement.

### Variables système importantes

#### Variables fondamentales

| Variable | Description | Exemple | Usage IA |
|----------|-------------|---------|----------|
| **HOME** | Répertoire personnel | /home/user | Localisation configs personnelles |
| **PATH** | Chemins des exécutables | /usr/bin:/usr/local/bin | Localiser Python, CUDA |
| **USER** | Nom d'utilisateur | alice | Scripts personnalisés |
| **SHELL** | Shell par défaut | /bin/bash | Configuration shell |

#### Variables de localisation

| Variable | Description | Impact |
|----------|-------------|--------|
| **LANG** | Langue système | fr_FR.UTF-8 | Affichage des erreurs |
| **TZ** | Fuseau horaire | Europe/Paris | Timestamps logs |
| **TERM** | Type de terminal | xterm-256color | Affichage couleurs |

### Manipulation des variables

#### Commandes de base

| Commande | Description | Usage |
|----------|-------------|-------|
| **echo $VAR** | Afficher variable | Vérifier configuration |
| **export VAR=value** | Définir variable | Configuration temporaire |
| **unset VAR** | Supprimer variable | Nettoyage environnement |
| **env** | Liste toutes variables | Audit configuration |

### Exemples pratiques

**Scénario : Vérifier l'environnement avant installation IA**

Variables à vérifier :
- PATH contient /usr/local/bin pour installations custom
- HOME pointe vers le bon répertoire
- LANG configuré pour l'affichage correct des erreurs

### Pratique non corrigée

**Exercice 1 : Exploration variables**
- Affichez toutes vos variables d'environnement
- Identifiez les variables système importantes
- Modifiez temporairement une variable

**Exercice 2 : Configuration personnalisée**
- Créez des variables personnalisées
- Testez leur persistance entre sessions
- Pratiquez l'export et unset

## Configuration PATH

### Théorie : Gestion des chemins d'exécution

Le PATH détermine où le système cherche les programmes. Pour l'IA, il faut souvent ajouter des chemins vers CUDA, conda, ou des installations personnalisées.

### Structure du PATH

#### Chemins typiques

| Chemin | Contenu | Importance IA |
|--------|---------|---------------|
| **/usr/bin** | Programmes système | Python système |
| **/usr/local/bin** | Installations locales | CUDA, frameworks |
| **~/.local/bin** | Programmes utilisateur | pip installations |
| **/opt/conda/bin** | Anaconda | Environnements Python |

#### Ordre de priorité

Le système cherche les programmes dans l'ordre du PATH :
- Premier trouvé = exécuté
- Attention aux conflits de versions
- Importance de l'ordre pour l'IA

### Modification du PATH

#### Méthodes temporaires

| Méthode | Commande | Durée |
|---------|----------|-------|
| **Session courante** | export PATH=/new/path:$PATH | Jusqu'à fermeture terminal |
| **Préfixe** | PATH=/new/path:$PATH command | Une commande |

#### Méthodes permanentes

**Fichiers de configuration :**
- **~/.bashrc** : Configuration bash personnelle
- **~/.profile** : Configuration générale shell
- **/etc/environment** : Configuration système globale

### Gestion des versions

#### Problèmes courants en IA

**Conflits typiques :**
- Python système vs Anaconda
- CUDA versions multiples
- Pip vs conda installations
- Versions TensorFlow/PyTorch

#### Solutions recommandées

**Bonnes pratiques :**
- Utiliser des environnements virtuels
- Prioriser conda dans le PATH
- Vérifier les versions régulièrement
- Documenter les configurations

### Exemples pratiques

**Scénario : Installer CUDA et configurer le PATH**

Configuration typique :
1. Ajouter /usr/local/cuda/bin au PATH
2. Configurer LD_LIBRARY_PATH pour les bibliothèques
3. Vérifier avec nvidia-smi et nvcc
4. Tester avec PyTorch/TensorFlow

### Pratique non corrigée

**Exercice 3 : Gestion PATH**
- Analysez votre PATH actuel
- Ajoutez temporairement un nouveau chemin
- Testez les conflits de priorité
- Configurez un PATH permanent

**Exercice 4 : Debug PATH**
- Créez volontairement un conflit de versions
- Identifiez quel programme est exécuté
- Résolvez le conflit en modifiant l'ordre

## Variables spécifiques à l'IA

### Théorie : Configuration optimale pour l'IA

Les frameworks d'IA utilisent des variables spécifiques pour optimiser les performances, configurer les GPUs, et contrôler l'utilisation des ressources.

### Variables CUDA/GPU

#### Configuration GPU

| Variable | Description | Exemple | Impact |
|----------|-------------|---------|--------|
| **CUDA_VISIBLE_DEVICES** | GPUs disponibles | 0,1 | Limite GPUs utilisés |
| **CUDA_DEVICE_ORDER** | Ordre énumération | PCI_BUS_ID | Ordre prévisible |
| **NVIDIA_VISIBLE_DEVICES** | Pour containers | all | Configuration Docker |

#### Variables performance

| Variable | Description | Valeur | Effet |
|----------|-------------|--------|-------|
| **OMP_NUM_THREADS** | Threads OpenMP | 4 | Contrôle parallélisme CPU |
| **MKL_NUM_THREADS** | Threads Intel MKL | 1 | Évite sur-threading |
| **NUMBA_NUM_THREADS** | Threads Numba | 4 | Optimise calculs numériques |

### Variables frameworks

#### TensorFlow

| Variable | Description | Utilité |
|----------|-------------|---------|
| **TF_CPP_MIN_LOG_LEVEL** | Niveau logs | Réduire verbosité |
| **TF_FORCE_GPU_ALLOW_GROWTH** | Croissance mémoire GPU | Éviter allocation complète |
| **TF_XLA_FLAGS** | Options XLA | Optimisations compilation |

#### PyTorch

| Variable | Description | Impact |
|----------|-------------|--------|
| **TORCH_HOME** | Cache modèles | Localisation personnalisée |
| **PYTORCH_CUDA_ALLOC_CONF** | Allocation CUDA | Gestion mémoire GPU |

### Variables de développement

#### Configuration Python

| Variable | Description | Usage IA |
|----------|-------------|----------|
| **PYTHONPATH** | Chemins modules Python | Projets personnalisés |
| **JUPYTER_CONFIG_DIR** | Config Jupyter | Notebooks personnalisés |
| **CONDA_DEFAULT_ENV** | Environnement par défaut | Auto-activation |

### Exemples pratiques

**Scénario : Configuration optimale pour entraînement multi-GPU**

Configuration recommandée :
- CUDA_VISIBLE_DEVICES selon disponibilité
- OMP_NUM_THREADS = nombre CPU / nombre GPU
- TF_FORCE_GPU_ALLOW_GROWTH=true
- Logs minimaux pour performance

### Optimisations spécifiques

#### Pour training intensif

**Configuration performance :**
- Limiter threads CPU pour éviter contention
- Configurer allocation mémoire GPU progressive
- Optimiser I/O et lecture datasets
- Réduire logging pour gain performance

#### Pour debugging

**Configuration debug :**
- Logs détaillés activés
- Checks GPU étendus
- Validation mémoire stricte
- Traces d'exécution disponibles

### Pratique non corrigée

**Exercice 5 : Configuration GPU**
- Configurez CUDA_VISIBLE_DEVICES
- Testez limitation GPU sur un script
- Optimisez les threads pour votre système
- Mesurez l'impact performance

**Exercice 6 : Optimisation frameworks**
- Configurez variables TensorFlow/PyTorch
- Testez différentes configurations
- Mesurez utilisation mémoire
- Documentez la configuration optimale

## Fichiers de configuration

### Théorie : Persistance des configurations

Les configurations doivent persister entre sessions. Linux utilise plusieurs fichiers pour charger automatiquement les variables et configurations au démarrage.

### Fichiers utilisateur

#### Hiérarchie de chargement

| Fichier | Quand chargé | Usage | Priorité |
|---------|--------------|-------|----------|
| **~/.profile** | Login shells | Config générale | Basse |
| **~/.bashrc** | Shells interactifs | Config bash | Moyenne |
| **~/.bash_profile** | Login bash | Override .profile | Haute |
| **~/.bash_logout** | Fermeture | Nettoyage | - |

#### Contenu typique IA

**~/.bashrc pour IA :**
- Configuration PATH avec conda/CUDA
- Variables GPU et performance
- Alias pour commandes fréquentes
- Activation environnement par défaut

### Configuration système

#### Fichiers globaux

| Fichier | Scope | Usage IA |
|---------|-------|----------|
| **/etc/environment** | Tous utilisateurs | Variables système |
| **/etc/profile** | Login shells | Config globale |
| **/etc/bash.bashrc** | Tous bash | Config partagée |

### Structure recommandée

#### Organisation .bashrc

**Sections suggérées :**
1. **Variables système** : PATH, LANG, etc.
2. **Variables IA** : CUDA, frameworks
3. **Alias utiles** : Raccourcis commandes
4. **Fonctions** : Scripts réutilisables
5. **Conda/venv** : Auto-activation

#### Exemple configuration IA

**Variables essentielles :**
- PATH incluant conda, CUDA
- CUDA_VISIBLE_DEVICES par défaut
- Optimisations performance
- Configuration Jupyter
- Alias pour monitoring

### Bonnes pratiques

#### Gestion des configurations

**Recommandations :**
- Commenter toutes les modifications
- Sauvegarder avant changements
- Tester dans nouveau terminal
- Organiser par sections logiques
- Versionner avec git

#### Debugging configurations

**Problèmes courants :**
- Conflits entre fichiers
- Variables non exportées
- Ordre de chargement incorrect
- Syntaxe bash incorrecte

### Exemples pratiques

**Scénario : Configuration complète poste de travail IA**

Setup complet :
1. **Variables système** dans .profile
2. **Config bash** dans .bashrc
3. **Alias IA** personnalisés
4. **Auto-activation** conda
5. **Monitoring** GPU automatique

### Automatisation

#### Scripts de configuration

**Deployment automatique :**
- Scripts d'installation environnement
- Configuration git des dotfiles
- Tests automatiques de config
- Backup/restore configurations

#### Templates réutilisables

**Configurations types :**
- Poste développement IA
- Serveur entraînement
- Environment production
- Setup cluster/HPC

### Pratique non corrigée

**Exercice 7 : Configuration permanente**
- Modifiez votre .bashrc pour l'IA
- Ajoutez variables et alias utiles
- Testez la persistance entre sessions
- Organisez votre configuration

**Exercice 8 : Backup et restauration**
- Sauvegardez vos configurations actuelles
- Créez une configuration IA complète
- Testez dans un nouveau terminal
- Pratiquez la restauration

**Exercice 9 : Configuration avancée**
- Créez des fonctions bash utiles pour l'IA
- Configurez auto-activation d'environnement
- Ajoutez monitoring automatique
- Documentez votre setup personnel

## Conclusion

### Points clés à retenir

- **Variables système** : HOME, PATH, USER pour la base
- **Configuration GPU** : CUDA_VISIBLE_DEVICES, threads optimaux
- **Frameworks** : Variables spécifiques TensorFlow/PyTorch
- **Persistance** : .bashrc et .profile pour configurations durables

### Compétences acquises

Après ce module, vous devriez être capable de :
- Configurer les variables d'environnement pour l'IA
- Gérer le PATH pour éviter les conflits de versions
- Optimiser les variables GPU et performance
- Créer des configurations persistantes et réutilisables

### Prochaines étapes

Le module suivant couvrira l'édition de fichiers et la manipulation de texte, essentiels pour configurer et maintenir vos projets IA.
